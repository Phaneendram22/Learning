#!/bin/bash

JUMP_USER="sh3237"
JUMP_HOST="zlsa9091arpy01ipr001.dcu.att.net"
TARGET_USER="root"

if [ -z "$1" ] || [ -z "$2" ]; then
  echo "Usage: $0 <TARGET_HOST> <NIC_PORT>"
  echo
  echo "Example: ./check_connection.sh *********** P3P1"
  echo
  exit 1
fi

TARGET_HOST="$1"
NIC_PORT="$2"

case "$NIC_PORT" in
  P3P1)
    REMOTE_COMMAND="racadm switchconnection view NIC.Slot.3-1-1"
    ;;
  P3P2)
    REMOTE_COMMAND="racadm switchconnection view NIC.Slot.3-2-1"
    ;;
  P6P1)
    REMOTE_COMMAND="racadm switchconnection view NIC.Slot.6-1-1"
    ;;
  P6P2)
    REMOTE_COMMAND="racadm switchconnection view NIC.Slot.6-2-1"
    ;;
  *)
    echo "Invalid NIC_PORT. Use one of: P3P1, P3P2, P6P1, P6P2"
    exit 1
    ;;
esac

# Run the remote command and capture the output
OUTPUT=$(ssh -J "${JUMP_USER}@${JUMP_HOST}" "${TARGET_USER}@${TARGET_HOST}" "${REMOTE_COMMAND}")
echo $OUTPUT

# Try to extract MAC address (assuming output contains something like "MAC Address : 00:11:22:33:44:55")
MAC=(echo "$OUTPUT" | grep -i 'SwitchConnectionID' | head -n1 | awk -F'=' '{print $3}'|awk '{print $1}'| xargs)
echo $MAC

# Display as a table
#printf "%-10s %-20s\n" "NIC_PORT" "MAC_ADDRESS"
#printf "%-10s %-20s\n" "$NIC_PORT" "${MAC}"



#!/bin/bash

JUMP_USER="sh3237"
JUMP_HOST="zlsa9091arpy01ipr001.dcu.att.net"
TARGET_USER="root"

# ----------------------------
# Argument check
# ----------------------------
if [ -z "$1" ] || [ -z "$2" ]; then
  echo "Usage: $0 <TARGET_HOST> <NIC_PORT>"
  echo "Example: ./check_connection.sh host P3P1"
  exit 1
fi

TARGET_HOST="$1"
NIC_PORT="$2"

# ----------------------------
# Map NIC_PORT to racadm NIC
# ----------------------------
case "$NIC_PORT" in
  P3P1) NIC_ID="NIC.Slot.3-1-1" ;;
  P3P2) NIC_ID="NIC.Slot.3-2-1" ;;
  P6P1) NIC_ID="NIC.Slot.6-1-1" ;;
  P6P2) NIC_ID="NIC.Slot.6-2-1" ;;
  *)
    echo "Invalid NIC_PORT. Use: P3P1, P3P2, P6P1, P6P2"
    exit 1
    ;;
esac

REMOTE_COMMAND="racadm switchconnection view ${NIC_ID}"

# ----------------------------
# Run racadm via jump host
# ----------------------------
OUTPUT=$(ssh -J "${JUMP_USER}@${JUMP_HOST}" \
  "${TARGET_USER}@${TARGET_HOST}" \
  "${REMOTE_COMMAND}")

# ----------------------------
# Extract MAC address
# ----------------------------
MAC=$(echo "$OUTPUT" \
  | sed -nE 's/.*=([0-9A-Fa-f:]{17}).*/\1/p' \
  | head -n1)

[ -z "$MAC" ] && MAC="N/A"

# ----------------------------
# Simple table output
# ----------------------------
printf "%-10s %-20s\n" "NIC_PORT" "MAC_ADDRESS"
printf "%-10s %-20s\n" "--------" "------------------"
printf "%-10s %-20s\n" "$NIC_PORT" "$MAC"

